parameters:
- name: target
  type: string

steps:
  - template: pre-steps.yml
  - script: |
        sudo apt-get install -qq -y clang ninja-build libgtk-3-dev
    condition: eq( variables['Agent.OS'], 'Linux' )
    
  # Build the flutter app
  - task: FlutterBuild@0
    inputs:
      target: ${{parameters.target}}
      projectDirectory: './tms'
      extraArgs: '--release'

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: './tms/build/${{parameters.target}}'
      archiveType: 'zip'

  - task: CopyFiles@2
    inputs:
      sourceFolder: './tms/build/${{parameters.target}}'
      targetFolder: $(Build.ArtifactStagingDirectory)
      contents: |
        '${{parameters.target}}.zip'

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: '${{parameters.target}}-client'
