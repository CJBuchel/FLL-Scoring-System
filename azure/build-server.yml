parameters:
- name: target
  type: string

steps:
  # Build the rust app
  # - task: Cargo@1
  #   inputs:
  #     cargoCommand: 'build --release'
  #     cargoWorkingDir: './server'
  #     verbose: false

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: './server/target/release'
      archiveType: 'zip'
      archiveFile: '$(Build.ArtifactStagingDirectory)/tms-server-${{parameters.target}}.zip'

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: 'server-${{parameters.target}}'
