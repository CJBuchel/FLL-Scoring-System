parameters:
- name: target
  type: string

steps:
  # Build the flutter app
  - task: FlutterBuild@0
    inputs:
      target: 'apk'
      projectDirectory: './tms'
      iosCodesign: false
      extraArgs: '--release'

  - task: FlutterBuild@0
    inputs:
      target: 'ios'
      projectDirectory: './tms'
      iosCodesign: false
      extraArgs: '--release'

  - task: FlutterBuild@0
    inputs:
      target: 'ipa'
      projectDirectory: './tms'
      iosCodesign: false
      extraArgs: '--release'

  - script: 'ls ./tms/build; ls ./tms/build/ios; ls ./tms/build/ios/ipa'

  - task: CopyFiles@2
    inputs:
      contents: '**/flutter-apk/**/*.apk'
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: CopyFiles@2
    inputs:
      contents: '**/*.ipa'
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: 'client-${{parameters.target}}'
