# Network Constants
## Ports
- `2121` Request Server
- `2122` Web Socket Server
- `5353` mDNS Server
- `8080` Webserver (if applicable)

## Names
- `_mdns-tms-server._udp.local` mDNS name

# Network Connection

## Connection Steps
- As of the 2023 update the service is now encrypted using a pair of RSA Asymmetric keys generated by both the server (4096 bit) and client (2048 bit).
- The setup is a custom encryption setup not using https or wss instead still running on http and ws in plain text.
- It's built like this to mitigate problems on public networks such as schools or universities which require proper certificates to be able to connect on https pipelines.
- While the service may seem like plain text and "unsafe", the service is still encrypted and provides the same emulation of real https and wss.

### Steps (Client to Server Connection from startup)
- The server boots up and generates a pair of keys using a 4096 bit encryption method.
- The server then broadcasts an mDNS name of `_mdns-tms-server`, in general the port should be `5353`.
- Clients may either use a direct ip connection by manually typing it in or a scanned connection using the mDNS server to resolve the server IP. 
- (The web client cannot scan, but will instead either use the host ip as the server IP, or will require the direct ip)
- Once the IP has been found/entered a handshake connection will begin.
- The client will connect to port 2121 on the server via http REST to register itself to the server.
  - The client will generate it's own set of RSA asymmetric keys (2048 bit) and will also generate a v4 uuid.
  - The client will send this data to the server as it's "registration" to the service
- The server will process this information and send back it's acceptance
  - The server will take the public key and the clients uuid and store it in a keyed map, using the uuid as the key.
  - It will then send a response message to the client with the servers public key along with a url with the current server ip and client uuid for web socket communication
- Once the client receives the response it stores the servers public key locally along with the url and will attempt a websocket connection
- Once the websocket is connected all communication to and from will be encrypted and decrypted using the set of RSA keys.
- The websocket will also only be used for small messages for pub sub communication and event updates. Data transmission will be held via http requests, but will also be end-to-end encrypted. The exception being the registration and unregistration urls.

# Network communication, pub sub
## Timer event example (starting timer)
- The client will send a request message to the server via encrypted http REST on port 2121.
- The server will process this request and start the server side timer.
- Once the server has started the timer, it will distribute a message to all the registered clients using websocket pub sub.
- The message may be a small event trigger like `{topic: "timer", message: SocketMessage { time: "150" }}`
- All clients subscribed to the timer topic, (dashboard and timer screens) will be updated with this message
- The server may repeatedly send this topic message until the timer has been completed