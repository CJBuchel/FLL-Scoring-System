
jobs:
- job: AIO_Docker
  pool:
    vmImage: 'ubuntu-latest'
  steps:
    - template: ./build-steps/env-setup-steps.yml
    - template: ./build-steps/setup-rust-steps.yml
    - template: ./build-steps/setup-flutter-steps.yml

    - task: Cargo@1
      inputs:
        cargoCommand: 'build --target x86_64-unknown-linux-musl --release'
        cargoWorkingDir: './server'
        verbose: true
    
    - task: FlutterBuild@0
      inputs:
        target: 'web'
        projectDirectory: './client'

    #  Build the docker image
    - task: DockerCompose@0
      inputs:
        containerregistrytype: 'Container Registry'
        dockerRegistryEndpoint: 'CJBuchel-Dockerhub1'
        dockerComposeFile: '**/docker-compose.yml'
        action: 'Run a Docker Compose command'
        dockerComposeCommand: 'build --pull'
