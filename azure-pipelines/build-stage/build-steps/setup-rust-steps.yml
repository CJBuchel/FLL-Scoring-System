steps:
  # install musl and openssl for linux
  - script: |
        sudo apt-get install -qq -y musl-tools musl-dev openssl
    condition: eq( variables['Agent.OS'], 'Linux' )
    displayName: 'Install musl and openssl'

  # update openssl certificates for linux
  - script: |
        sudo update-ca-certificates
    condition: eq( variables['Agent.OS'], 'Linux' )
    displayName: 'Update openssl certificates'

  # # Get nightly releases (needed for rust rocket version (v0.5.0-rc.3))
  # - task: Rustup@1
  #   inputs:
  #     rustupCommand: 'default nightly'
  #     verbose: false

  # Rust install for linux MUSL target
  - task: Rustup@1
    displayName: 'Install Rust for musl linux (required for docker)'
    condition: eq( variables['Agent.OS'], 'Linux' )
    inputs:
      rustupCommand: 'target install x86_64-unknown-linux-musl'
      verbose: false

  # Rust install for linux gnu target
  - task: Rustup@1
    displayName: 'Install Rust for gnu linux'
    condition: eq( variables['Agent.OS'], 'Linux' )
    inputs:
      rustupCommand: 'target install x86_64-unknown-linux-gnu'
      verbose: false

  # Rust install for macos target
  - task: Rustup@1
    displayName: 'Install Rust for macos'
    condition: eq( variables['Agent.OS'], 'Darwin' )
    inputs:
      rustupCommand: 'target install x86_64-apple-darwin'
      verbose: false

  # Rust install for windows target
  - task: Rustup@1
    displayName: 'Install Rust for windows'
    condition: eq( variables['Agent.OS'], 'Windows_NT' )
    inputs:
      rustupCommand: 'target install x86_64-pc-windows-msvc'
      verbose: false